<% if existing_outline && !existing_outline.empty? %>
根据讨论的输入信息，以及以下现有提纲内容：
<%= JSON.pretty_generate(existing_outline) %>

请基于这个现有提纲进行修改和完善。考虑以下输入内容：
<%= contents %>

修改要求：
1. 根据新的讨论内容调整提纲结构
2. 保持原有合理部分，修改需要调整的部分
3. 考虑新的证据和观点，完善论证链条
4. 调整语言风格和章节概要以适应新的内容
<% else %>
针对主题《<%= query_text %>》写一篇文章，有以下一些输入内容

<%= contents %>

为这个主题，规划一个写作提纲。整体要求：
1. 要考虑详略区分，不要平均用力。
2. 要考虑传递核心观点，并且在合适的章节展示。
3. 要关注论证的严谨，提供充足的支撑证据。
4. 要考虑语言风格的一致性，在特定章节的summary中，提示写作者，适合的语言风格与关键金句。
5. 考虑文章的字数限制，规划适当的章节层次与数量
<% end %>

写作这个主题，可能分为多个章节，目录格式为
## 1.
### 1.1.
#### 1.1.1.
输出格式为JSON：

{
    "article": {
        "title": "# Essay Title",
        "file": "file_name.md"
        "style": "Writing Style",
        "audience": "Target Audience",
        "length": #根据用户要求确定，默认为5000字
    },
    "outline":{
        "1.": {
            "title": "## 第一章 标题1",
            "summary": "第一章内容概要",
            "length": # 字数估算
        },
        "1.1.":{
            "title": "### 第一节 标题1",
            "summary": "第一节内容概要",
            "length": # 字数估算
        },
        "1.2.":{
            "title": "### 第二节 标题2",
            "summary": "第二节内容概要",
            "length": # 字数估算
        },
        .....//可以添加更多小节
        "2.": {
            "title": "## 第二章 标题2",
            "summary": "第二章内容概要",
            "length": # 字数估算
        },
        "2.1.":{
            "title": "### 第一节 标题1",
            "summary": "第一节内容概要",
            "length": # 字数估算
        },
        .....//可以添加更多章
    }
    "query": "进一步查询的内容"
}